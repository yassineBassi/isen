<app-header
  [back]="true"
  [title]="type ? (type == 'buy' ? 'Available Product' : 'Posted products') : ''"
  [backLink]="'/tabs/buy-and-sell'"
  [search]="true"
  (searchKeyUp)="search($event)"
></app-header>

<app-loader *ngIf="pageLoading"></app-loader>

<ion-content>

  <ion-refresher slot="fixed" pullFactor="0.5" pullMin="100" pullMax="200"  (ionRefresh)="getProducts($event, true)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="h-100 d-flex align-items-center" *ngIf="products && !products.length">
    <div class="w-100 text-center px-4">
      <img src="./../../../../assets/shop.svg" alt="">
      <span class="empty-alert d-block mt-4">
        <span *ngIf="type == 'sell'">
          You didn't post any product yet<br/>
          <small>Click on <i class="fas fa-plus"></i> to sell your first product</small>
        </span>
        <span *ngIf="type == 'buy'">There is no product available to buy yet!</span>
      </span>
    </div>
  </div>

  <ion-list *ngIf="products">
    <ion-item *ngFor="let product of products" [routerLink]="['/tabs/buy-and-sell/product/' + product.id]">
      <ion-thumbnail class="ml-2">
        <ion-img [src]="product.photo.path"></ion-img>
      </ion-thumbnail>
      <ion-label class="ml-2">
        <span class="d-block">{{ product.label }}</span>
        <small>{{ product.createdAt | extractDate }}</small>
      </ion-label>
      <span class="mr-2 text-right">
        <span class="d-block">{{ product.price }} {{ product.currency }}</span>
        <small class="d-block">{{ product.country }}, {{ product.city }}</small>
      </span>
    </ion-item>
  </ion-list>

  <ion-infinite-scroll #infinitScroll threshold="100px" (ionInfinite)="getProducts($event)">
    <ion-infinite-scroll-content
      loadingSpinner="crescent"
    >
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="type == 'sell'">
    <ion-fab-button color="primary" (click)="showProductForm()" class="mr-2">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>
