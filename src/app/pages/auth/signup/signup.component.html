<app-loader *ngIf="pageLoading"></app-loader>

<ion-content>
  <ion-row *ngIf="step < steps.length - 1">
    <ion-col>
      <ion-button
        fill="clear"
        shape="round"
        size="large"
        color="secondary"
        (click)="back()"
      >
        <i class="fas fa-arrow-left"></i>
      </ion-button>
    </ion-col>
  </ion-row>

  <ion-row *ngIf="step < steps.length - 1">
    <ion-col class="px-3">
      <ion-progress-bar  color="secondary" [value]="(step + 1) * 0.2"></ion-progress-bar>
    </ion-col>
  </ion-row>

  <ion-row [class]="[step == steps.length - 1 ? 'h-100' : 'mt-4']">
    <ion-col size="12" class="text-center" *ngIf="step < steps.length - 1">
      <img src="../../../../assets/logo.svg" class="logo-img" alt="">
    </ion-col>
    <ion-col [class]="[step == steps.length - 1 ? 'my-auto' : 'px-5']" class="text-center" size="12">
      <form [formGroup]="form" *ngIf="step < steps.length - 2" class="form">

        <!-- user email -->
        <div class="form-group" *ngIf="steps[step] == 'email'">
          <h2>What's your email ?</h2>
          <ion-item class="w-100">
            <ion-input formControlName="email" type="text" placeholder="E-mail"></ion-input>
          </ion-item>
          <div class="w-100 text-center mt-4" *ngIf="validationErrors['email']">
            <span class="d-block text-danger" *ngFor="let error of validationErrors['email']">{{ error }}</span>
          </div>
        </div>

        <!-- user full name  -->
        <div class="form-group" *ngIf="steps[step] == 'name'">
          <h2>What's your Name</h2>
          <ion-item class="w-100">
            <ion-input formControlName="firstName" type="text" placeholder="First Name"></ion-input>
          </ion-item>
          <ion-item class="w-100">
            <ion-input formControlName="lastName" type="text" placeholder="Last Name"></ion-input>
          </ion-item>
          <div class="mt-4">
            <div class="w-100 text-center" *ngIf="validationErrors['firstName']">
              <span class="d-block text-danger" *ngFor="let error of validationErrors['firstName']">{{ error }}</span>
            </div>

            <div class="w-100 text-center" *ngIf="validationErrors['lastName']">
              <span class="d-block text-danger" *ngFor="let error of validationErrors['lastName']">{{ error }}</span>
            </div>
          </div>
        </div>

        <!-- user password  -->
        <div class="form-group" *ngIf="steps[step] == 'password'">
          <h2>Set Password</h2>
          <ion-item class="w-100">
            <ion-input ngModel formControlName="password" type="password" placeholder="Password"></ion-input>
          </ion-item>
          <ion-item class="w-100">
            <ion-input ngModel formControlName="password_confirmation" type="password" placeholder="Password Confirmation"></ion-input>
          </ion-item>

          <div class="w-100 text-center mt-4">
            <span
              class="d-block text-danger"
              *ngIf="password.value.length && password_confirmation.value.length && password.value != password_confirmation.value"
            >
              Password and password confirmation don't match
            </span>
            <div *ngIf="validationErrors['password']">
              <span class="d-block text-danger" *ngFor="let error of validationErrors['password']">{{ error }}</span>
            </div>
          </div>
        </div>

        <!-- user birthdate -->
        <div class="form-group" *ngIf="steps[step] == 'birthDate'">
          <h2>When's your Birthday ?</h2>
          <ion-item class="w-100">
            <ion-input ngModel formControlName="birthDate" type="date"></ion-input>
          </ion-item>
          <div class="w-100 text-center mt-4" *ngIf="validationErrors['birthDate']">
            <span class="d-block text-danger" *ngFor="let error of validationErrors['birthDate']">{{ error }}</span>
          </div>
        </div>

        <!-- user gender  -->
        <div *ngIf="steps[step] == 'gender'">
          <h2>What's your Gender ?</h2>
          <ion-chip (click)="gender = 'male'" [class.selected]="gender == 'male'">
            male
          </ion-chip>
          <ion-chip (click)="gender = 'female'" [class.selected]="gender == 'female'">
            female
          </ion-chip>

          <div class="w-100 text-center mt-4" *ngIf="validationErrors['gender']">
            <span class="d-block text-danger" *ngFor="let error of validationErrors['gender']">{{ error }}</span>
          </div>
        </div>
      </form>
      <!-- user location  -->
      <div *ngIf="steps[step] == 'location'">
        <h2>Almost done!</h2>
        <h2>Where do you live ?</h2>
        <ion-item class="w-100 mt-3">
          <div class="w-100 h-100">
            <ion-button
              expand="block"
              fill="clear"
              color="dark"
              size="default"
              class="ion-no-padding ion-no-margin text-capitalize h-100"
              (click)="presentCountriesModal()"
            >
              <span class="w-100 my-3 ml-2 text-left country-btn">
                {{ selectedCountry ? selectedCountry : 'Country' }}
              </span>
            </ion-button>
          </div>
        </ion-item>
        <div class="w-100 text-center mt-4" *ngIf="validationErrors['country']">
          <span class="d-block text-danger" *ngFor="let error of validationErrors['country']">{{ error }}</span>
        </div>
        <ion-item class="w-100 mt-3">
          <div class="w-100 h-100">
            <ion-button
              expand="block"
              fill="clear"
              color="dark"
              size="default"
              class="ion-no-padding ion-no-margin text-capitalize h-100"
              (click)="presentCitiesModal()"
              [disabled]="!selectedCountry"
            >
              <span class="w-100 my-3 ml-2 text-left country-btn">
                {{ selectedCity ? selectedCity : 'City' }}
              </span>
            </ion-button>
          </div>
        </ion-item>
        <div class="w-100 text-center mt-4" *ngIf="validationErrors['city']">
          <span class="d-block text-danger" *ngFor="let error of validationErrors['city']">{{ error }}</span>
        </div>
      </div>

      <!-- success  -->
      <div class="w-100 text-center" *ngIf="steps[step] == 'success'">
        <div class="d-flex justify-content-center">
          <div class="check-container">
            <ion-fab-button
              class="check-button"
            >
              <i class="fas fa-check text-white"></i>
            </ion-fab-button>
          </div>
        </div>
        <span class="text-success d-block congrats-text mt-2">Congratulation !! </span>
        <span class="success-icon d-block desc-text mt-1">Your <b>GELOO</b> Account has been created successfully !!</span>
      </div>
    </ion-col>
  </ion-row>
</ion-content>
<ion-footer>

  <ion-button
    expand="block"
    color="secondary"
    class="my-2 mx-2"
    (click)="continue()"
    [disabled]="!isValid()"
    *ngIf="steps[step] != 'success'"
  >
    <span *ngIf="btnLoading"><i class="fas fa-circle-notch fa-spin"></i></span>
    <span *ngIf="!btnLoading">{{ step == steps.length - 2 ? 'Done' : 'Continue' }}</span>
  </ion-button>
  <ion-button
    routerLink="/auth/signin"
    color="success"
    size="default"
    expand="block"
    class="my-2 mx-2"
    *ngIf="steps[step] == 'success'"
  >
    Login now !
  </ion-button>
</ion-footer>
